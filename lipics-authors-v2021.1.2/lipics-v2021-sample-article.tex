%

\documentclass[a4paper,UKenglish,cleveref, autoref, thm-restate]{lipics-v2021}
%This is a template for producing LIPIcs articles. 
%See lipics-v2021-authors-guidelines.pdf for further information.
%for A4 paper format use option "a4paper", for US-letter use option "letterpaper"
%for british hyphenation rules use option "UKenglish", for american hyphenation rules use option "USenglish"
%for section-numbered lemmas etc., use "numberwithinsect"
%for enabling cleveref support, use "cleveref"
%for enabling autoref support, use "autoref"
%for anonymousing the authors (e.g. for double-blind review), add "anonymous"
%for enabling thm-restate support, use "thm-restate"
%for enabling a two-column layout for the author/affilation part (only applicable for > 6 authors), use "authorcolumns"
%for producing a PDF according the PDF/A standard, add "pdfa"

%\pdfoutput=1 %uncomment to ensure pdflatex processing (mandatatory e.g. to submit to arXiv)
%\hideLIPIcs  %uncomment to remove references to LIPIcs series (logo, DOI, ...), e.g. when preparing a pre-final version to be uploaded to arXiv or another public repository

%\graphicspath{{./graphics/}}%helpful if your graphic files are in another directory

\bibliographystyle{plainurl}% the mandatory bibstyle

\title{Formalising $\operatorname{Proj}$ Construction in Lean} %TODO Please add

%\titlerunning{Dummy short title} %TODO optional, please use if title is longer than one line

% \author{Jane {Open Access}}{Dummy University Computing Laboratory, [optional: Address], Country \and My second affiliation, Country \and \url{http://www.myhomepage.edu} }{johnqpublic@dummyuni.org}{https://orcid.org/0000-0002-1825-0097}{(Optional) author-specific funding acknowledgements}%TODO mandatory, please use full name; only 1 author per \author macro; first two parameters are mandatory, other parameters can be empty. Please provide at least the name of the affiliation and the country. The full address is optional. Use additional curly braces to indicate the correct name splitting when the last name consists of multiple name parts.
\author{Jujian Zhang}{Department of Mathematics, Imperial College London \and \url{https://www.imperial.ac.uk/}}{jujian.zhang19@imperial.ac.uk}{https://orcid.org/0000-0001-7340-2703}{Schr\"odinger Scholarship Scheme}
% \author{Joan R. Public\footnote{Optional footnote, e.g. to mark corresponding author}}{Department of Informatics, Dummy College, [optional: Address], Country}{joanrpublic@dummycollege.org}{[orcid]}{[funding]}

% \authorrunning{J. Open Access and J.\,R. Public} %TODO mandatory. First: Use abbreviated first/middle names. Second (only in severe cases): Use first author plus 'et al.'
\authorrunning{J. Zhang}
% \Copyright{Jane Open Access and Joan R. Public} %TODO mandatory, please use full first names. LIPIcs license is "CC-BY";  http://creativecommons.org/licenses/by/3.0/
\Copyright{Jujian Zhang}
% \ccsdesc[100]{\textcolor{red}{Replace ccsdesc macro with valid one}} %TODO mandatory: Please choose ACM 2012 classifications from https://dl.acm.org/ccs/ccs_flat.cfm 

\ccsdesc[500]{Theory of computation~Logic and verification}
\ccsdesc[500]{Mathematics of computing~Topology}
\ccsdesc[500]{Theory of computation~Interactive proof systems}

\keywords{Lean, formalisation, algebraic geometry, scheme, Proj construction, projective geometry} %TODO mandatory; please add comma-separated list of keywords

\category{} %optional, e.g. invited paper

\relatedversion{} %optional, e.g. full version hosted on arXiv, HAL, or other respository/website
%\relatedversiondetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93]{Classification (e.g. Full Version, Extended Version, Previous Version}{URL to related version} %linktext and cite are optional

%\supplement{}%optional, e.g. related research data, source code, ... hosted on a repository like zenodo, figshare, GitHub, ...
%\supplementdetails[linktext={opt. text shown instead of the URL}, cite=DBLP:books/mk/GrayR93, subcategory={Description, Subcategory}, swhid={Software Heritage Identifier}]{General Classification (e.g. Software, Dataset, Model, ...)}{URL to related version} %linktext, cite, and subcategory are optional

%\funding{(Optional) general funding statement \dots}%optional, to capture a funding statement, which applies to all authors. Please enter author specific funding statements as fifth argument of the \author macro.

\funding{}

\acknowledgements{I want to thank Eric Wieser for his contribution and suggestion in formalising homogeneous ideal and homogeneous localisation; Andrew Yang and Junyan Xu for their review and suggestion of my often badly written code; Kevin Buzzard for suggesting this project and all the contributors to \textsf{mathlib} for otherwise this project would not have been possible.}

\nolinenumbers %uncomment to disable line numbering

%Editor-only macros:: begin (do not touch as author)%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\EventEditors{John Q. Open and Joan R. Access}
\EventNoEds{2}
\EventLongTitle{42nd Conference on Very Important Topics (CVIT 2016)}
\EventShortTitle{CVIT 2016}
\EventAcronym{CVIT}
\EventYear{2016}
\EventDate{December 24--27, 2016}
\EventLocation{Little Whinging, United Kingdom}
\EventLogo{}
\SeriesVolume{42}
\ArticleNo{23}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\supplementdetails[subcategory={Source Code}]{Software}{https://github.com/leanprover-community/mathlib/pull/18138/commits/00c4b0918a2c7a8b62291581b0e1eddf2357b5be}

% \usepackage{sourcecodepro}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{upquote}
\usepackage{color}
\definecolor{keywordcolor}{rgb}{0.7, 0.1, 0.1}   % red
\definecolor{tacticcolor}{rgb}{0.0, 0.1, 0.6}    % blue
\definecolor{commentcolor}{rgb}{0.4, 0.4, 0.4}   % grey
\definecolor{symbolcolor}{rgb}{0.0, 0.1, 0.6}    % blue
\definecolor{sortcolor}{rgb}{0.1, 0.5, 0.1}      % green
\definecolor{attributecolor}{rgb}{0.7, 0.1, 0.1} % red

\def\lstlanguagefiles{lstlean.tex}
% set default language
\lstset{language=lean, escapeinside={(*@}{@*)}, }

\usepackage{tikz-cd}
\usepackage{amscd}
\usepackage[nice]{nicefrac}

\begin{document}

\maketitle

\begin{abstract}
    Many objects of interest in mathematics can be studied both analytically and algebraically, while at the same time, it is known that analytic geometry and algebraic geometry generally does not behave the same. However, the famous GAGA theorem asserts that for projective varieties, analytic and algebraic geometries are closely related; proof of the Fermat last theorem, for example, use this technique to transport between the two worlds \cite{serre1955geometrie}. A crucial step of proving GAGA is to calculate cohomology of projective spaces \cite{neeman2007algebraic}, thus I formalise $\operatorname{Proj}$ construction for any $\mathbb{N}$-graded $R$-algebra $A$ as a starting point to the GAGA theorem and projective $n$-space is constructed as $\operatorname{Proj} A[X_0,\dots, X_n]$. This would the first family of non-affine schemes formalised in any theorem prover.
\end{abstract}

\section{Introduction}
Algebraic geometry concerns polynomials and analytic geometry concerns holomorphic functions. Though all polynomials are holomorphic, the converse is not true; thus many analytic objects are not algebraic, for example $\{x \in \mathbb{C} \mid \sin(x) = 0\}$ can not be defined as zero locus of polynomials in one variable, for polynomials always have only finite number of zeros. However, for projective varieties over $\mathbb{C}$, the categories of algebraic and analytic coherent sheaves are equivalent; a  consequence for this statement is that all closed analytic subspace of projective $n$-space $\mathbb{P}_n$ is also algebraic \cite{serre1955geometrie,chowtheorem}. A crucial step of proving the above statement is to consider cohomology of projective $n$-space $\mathbb{P}_n$  \cite{neeman2007algebraic}. 

While one can define $\mathbb{P}_n$ over $\mathbb{C}$ without consideration of other projective varieties, it would be more fruitful to formalise $\operatorname{Proj}$ construction as a \textbf{scheme} and recover $\mathbb{P}_n$ as $\operatorname{Proj} \mathbb{C}[X_0,\dots, X_n]$, since, among other reasons, by considering different base rings, one obtain different projective varieties, for example, for any homogeneous polynomials $f_1,\dots, f_k$, $\operatorname{Proj}\left(\frac{\mathbb{C}[X_0,\dots,X_n]}{(f_1,\dots,f_k)}\right)$ defines a projective hypersurface over $\mathbb{C}$.

In this paper I describe a formal construction of $\operatorname{Proj} A$ in the Lean3 theorem prover \cite{de2015lean} by closely following \cite[Chapter~II]{hartshorne1977graduate}. The formal construction uses various results from the Lean mathematical library \textsf{mathlib}, most notably the graded algebra and $\operatorname{Spec}$ construction; this project has been partly accepted into \textsf{mathlib} already while the remaining part is still undergoing a review process. The code discussed in this paper can be found on GitHub\footnote{url: \texttt{https://github.com/leanprover-community/mathlib/pull/18138/}}.  I have freely used the axiom of choice and the law of excluded middle throughout this project since the rest of \textsf{mathlib} freely use classical reasoning as well; consequently, the final construction is not computable.

As previously mentioned, $\operatorname{Proj}$ construction heavily depends on graded algebra and $\operatorname{Spec}$ construction. A detailed description of graded algebra in Lean and \textsf{mathlib} as well as a comparison of graded algebra with that in other theorem provers can be found in \cite{wieser2022graded}; for my purpose, I have chosen to use internal grading for any graded ring $A \cong \bigoplus \mathcal{A}_i$ so that the result of the construction is about homogeneous prime ideals of $A$ directly instead of $\bigoplus_i \mathcal{A}_i$. The earliest complete $\operatorname{Spec}$ construction in Lean can be found in \cite{buzzard2022schemes} where the construction followed a ``sheaf-on-a-basis'' approach from \cite[\href{https://stacks.math.columbia.edu/tag/01HR}{Section 01HR}]{stacks-project}, however, it differs significantly from the $\operatorname{Spec}$ construction currently found in \textsf{mathlib} where the construction follows \cite[Chapter~II]{hartshorne1977graduate}; for this reason, I have also chosen to follow the definition in \cite[Chapter~II]{hartshorne1977graduate} while hand-waving part (which is almost the whole proof) was made to be explicit. Some other theorem provers also have or partially have $\operatorname{Spec}$ construction: in Isabelle/HOL, $\operatorname{Spec}$ is formalised by using locales and rewriting topology and ring theory part of the existing library in \cite{doi:10.1080/10586458.2022.2062073}, however, the category of scheme is yet to be formalized; an early formalisation of $\operatorname{Spec}$ in Coq can be found in \cite{chicli2001formalisation} and a definition of scheme in general can be found in its \texttt{UniMath} library; due to homotopy type theory of \texttt{Agda}, only a partial formalisation of $\operatorname{Spec}$ construction can be found in \cite{mortbergtowards}. Though some theorem provers have defined a general scheme, I could not find any concrete construction of a scheme other than $\operatorname{Spec}$ of a ring\footnote{In this paper, all rings are assumed to be unital and commutative.}.

After explaining the mathematical details involved in $\operatorname{Proj}$ construction in Section~\ref{sec:maths}, Lean code will be provided and explained in Section~\ref{sec:formalisation}. For typographical reasons, some code of formalisation will be omitted and marked as \lstinline{sorry} or \lstinline{_} and some code presented in this paper is pseudocode that closely resembles the actual code but with notations and names altered to make it more readable and presentable.

\section{Mathematical details}\label{sec:maths}
In this section, certain familiarity with basic ring theory, topology and category theory will be assumed. In \Cref{sec:pre-def,sec:def_scheme}, definition of a scheme is explained in detail; $\operatorname{Spec}$ construction will also be briefly explained to fix the mathematical approach used in \textsf{mathlib}. Then by following the definition of a scheme step by step, $\operatorname{Proj}$ construction will be explained in \Cref{sec:proj_construction_maths}.

\subsection{Sheaves and Locally Ringed Spaces}\label{sec:pre-def}
Let $X$ be a topological space and $\mathfrak{Opens}(X)$ be the category of open subsets of $X$.

\begin{definition}[Presheaves~\cite{maclane2012sheaves}] 
    Let $C$ be a category, a $C$-valued presheaf $\mathcal{F}$ on $X$ is a functor $\mathfrak{Opens}(X)^{\mathsf{op}} \Longrightarrow C$. Morphisms between $C$-valued presheaves $\mathcal{F, G}$ are natural transformations. The category thus formed is denoted as $\mathfrak{PSh}(X, C)$.
    \label{def:presheaf}
\end{definition}
In this paper, the category of interest is the category of presheaves of rings $\mathfrak{Psh}(X, \mathfrak{Ring})$. More explicitly, a presheaf of rings $\mathcal{F}$ assigns each open subset $U \subseteq X$ with a ring $\mathcal{F}(U)$ whose elements are called sections on $U$ and for any open subsets $U \subseteq V\subseteq X$, $\mathcal F$ assigns a ring homomorphism $\mathcal{F}(V)\to\mathcal{F}(U)$ often denoted as $\mathrm{res}^V_U$ or simply with a vertical bar $s\!\mid_U$ (a section $s$ on $V$ restricted to $U$). Examples of presheaf of rings are abundant: considering open subsets of $\mathbb{C}$, $U \mapsto \{\text{(continuous, holomorphic) functions on~} U\}$ with the natural restriction map defines presheaf of rings. In these examples, compatible sections on different open subsets can be glued together to form bigger sections on the union of the said open subsets; this property can be generalized to arbitrary categories:

\begin{definition}[Sheaves~\cite{maclane2012sheaves,stacks-project}]
    A presheaf $\mathcal{F}\in\mathfrak{Psh}(X, C)$ is said to be a sheaf if for any open covering of open set $U=\bigcup_i U_i \subseteq X$, the following diagram is an equalizer
    $$
        \begin{tikzcd}[sep=huge]
        \mathcal{F}(U) \arrow[r, "\left(\mathrm{res}^U_{U_i}\right)"] & \prod_i \mathcal{F}(U_i) \arrow[r, "\left(\mathrm{res}^{U_i}_{U_i\cap U_j}\right)"] \arrow[r, shift left, "\left(\mathrm{res}^{U_j}_{U_i\cap U_j}\right)"'] & \prod_{i, j} F(U_i \cap U_j).
        \end{tikzcd}
    $$
    The category of sheaves $\mathfrak{Sh}(X,C)$ is the full subcategory of the category of presheaves satisfying the sheaf condition.
\end{definition}

\begin{definition}[Locally Ringed Space~\cite{stacks-project, hartshorne1977graduate}] 
    If $\mathcal{O}_X$ is a sheaf on $X$, then the pair $(X, \mathcal{O}_X)$ is called a ringed space; a morphism between two ringed space $(X, \mathcal{O}_X)$ and $(Y, \mathcal{O}_Y)$ is a pair $(f, \phi)$ such that $f: X \to Y$ is continuous and $\phi : \mathcal{O}_Y\to f_*\mathcal{O}_X$ is a morphism of sheaves where $f_*\mathcal{O}_X \in\mathfrak{Sh}(Y)$ assigns $V \subseteq Y$ to $\mathcal{O}_X(f^{-1}(V))$. A locally ringed space $(X, \mathcal{O}_X)$ is ringed space such that for any $x \in X$, its stalk $\mathcal{O}_{X, x}$ is a local ring where $\mathcal{O}_{X, x}=\operatorname{colim}_{x \in U \in \mathfrak{Opens} X} \mathcal{O}_X(U)$; a morphism between two locally ringed spaces $(X, \mathcal{O}_X)$ and $(Y, \mathcal{O}_Y)$ is a morphism $(f, \phi)$ of ringed space such that for any $x\in X$ the ring homomorphism induced on stalk $\phi_x : \mathcal{O}_{Y, f(x)}\to \mathcal{O}_{X, x}$ is local.
\end{definition}

Following from the previous definitions, if $\mathcal{O}_X$ is a presheaf and $U\subseteq X$ is an open subset, then there is a presheaf $\mathcal{O}_X\!\mid_U$ on $U$ by assigning every open subset $V$ of $U$ to $\mathcal{O}_X(V)$, this is called restricting a presheaf; sheaves, ringed spaces and locally ringed spaces can also be similarly restricted.

\subsection{Definition of Affine Scheme and Scheme}\label{sec:def_scheme}

\paragraph*{Spec construction} Let $R$ be a ring and $\operatorname{Spec} R$ denote the set of prime ideals of $R$. Then for any subset $s \subseteq R$, its zero locus is defined as $\left\{\mathfrak{p} \mid s \subseteq \mathfrak{p}\right\}$. These zero loci can be considered as closed subsets of $\operatorname{Spec} R$, the topology thus formed is called the Zariski topology. Then a sheaf of rings on $\operatorname{Spec} R$ can be defined by assign $U \subseteq \operatorname{Spec} R$ to the ring
$$
\left\{s : \prod_{x \in U} R_x \mid s \text{~is locally a fraction}\right\},
$$
where $s$ is locally a fraction if and only if for any prime ideal $x \in U$, there is always an open subset $x \in V \subseteq U$ and $a, b \in R$ such that for any prime ideal $y \in V$, $b \not\in y$ and $s(y) = \frac{a}{b}$. This sheaf $\mathcal{O}$ is called the structure sheaf of $\operatorname{Spec}R$. $(\operatorname{Spec} R, \mathcal{O})$ is a locally ringed space because for any prime ideal $x\subseteq R$, $\mathcal{O}_{x}\cong A_x$ \cite{hartshorne1977graduate}.

\paragraph*{Scheme}

\begin{definition}[Scheme]
    A locally ringed space $(X, \mathcal{O}_X)$ is said to be a scheme if for any $x \in X$, there is always some ring $R$ and some open subset $x \in U \subseteq X$ such that $(U, \mathcal{O}_X\!\mid_U) \cong (\operatorname{Spec} R, \mathcal{O}_{\operatorname{Spec} R})$ as locally ringed spaces. The category of schemes is the full subcategory of locally ringed spaces.
\end{definition}

Thus to construct a scheme, one needs the following:
\begin{itemize}
    \item a topological space $X$;
    \item a presheaf $\mathcal{O}$;
    \item a proof that $\mathcal{O}$ satisfies the sheaf condition;
    \item a proof that all stalks are local;
    \item an open covering $\{U_i\}$ of $X$;
    \item a collection of rings $\{R_i\}$ and isomorphism $(U_i, \mathcal{O}_X\!\mid_{U_i})\cong(\operatorname{Spec}R_i, \mathcal{O}_{\operatorname{Spec} R})$.
\end{itemize}
In \Cref{sec:proj_construction_maths}, $\operatorname{Proj}$ construction will be described following the steps above.

\subsection{Proj Construction}\label{sec:proj_construction_maths}
Throughout this section, $R$ will denote a ring and $A$ an $\mathbb{N}$-graded $R$-algebra, in order to keep notations the same as \Cref{sec:formalisation}, the grading of $A$ will be written as $\mathcal{A}$, i.e. $A\cong \bigoplus_{i\in\mathbb{N}}\mathcal{A}_i$ as $R$-algebras.

\paragraph*{Topology}
\begin{definition}[$\operatorname{Proj}\mathcal{A}$ as a set]
    $\operatorname{Proj}\mathcal{A}$ is defined to be
    $
        \left\{\mathfrak{p}\in \operatorname{Spec}A\mid \mathfrak{p}\text{~is homogeneous and relevant}\right\}    
    $, where
    \begin{itemize}
        \item an ideal $\mathfrak{p}\subseteq A$ is said to be homogeneous if for any $a \in \mathfrak{p}$ and $i\in \mathbb{N}$, $a_i$ is in $\mathfrak{p}$ as well where $a_i \in \mathcal{A}_i$ is the $i$-th projection of $a$ with respect to grading $\mathcal{A}$;
        \item an ideal $\mathfrak{p}\subseteq A$ is said to be relevant if $\bigoplus_{i=1}^\infty \mathcal{A}_i\not\subseteq \mathfrak{p}$.
    \end{itemize}
\end{definition}

Similar to $\operatorname{Spec}$ construction in \Cref{sec:def_scheme}, there is a topology on $\operatorname{Proj}\mathcal{A}$ whose close sets are exactly the zero loci where for any $s \subseteq A$, zero locus of $s$ is $\{\mathfrak p\in \operatorname{Proj}\mathcal{A}\mid s \subseteq \mathfrak{p}\}$; this topology is also called the Zariski topology. For any $a \in A$, $D(a)$ denotes the set $\{x\in \operatorname{Proj}\mathcal{A}\mid a\not\in x\}$.

\begin{theorem} 
    For any $a\in A$, $D(a)$ is open in Zariski topology and $\{D(a)\mid a\in A\}$ forms a basis of the Zariski topology \cite{stacks-project}.
    
\end{theorem}

\paragraph*{Structure sheaf}
Let $U\subseteq \operatorname{Proj}\mathcal{A}$ be an open subset, the sections on $U$ are defined to be
$$
    \mathcal{O}(U) = \left\{s \in \prod_{x\in U}A_x^0\mid s\text{~is locally a homogeneous fraction}\right\},   
$$
where $A^0_{\mathfrak{p}}$ denotes the homogeneous localization of $A$ at a homogeneous prime ideal $\mathfrak{p}$, i.e. the subring of $A_{\mathfrak{p}}$ of elements of degree zero and $s$ is said to be locally a homogeneous fraction if for any $x \in U$, there is some open subset $x\in V \subseteq U$, $i\in\mathbb{N}$ and $a, b\in\mathcal{A}_i$ such that for all $y\in V$, $s(y)=\frac{a}{b}$. Equipped with natural restriction maps, $\mathcal{O}$ defined in this way forms a presheaf; sheaf condition of $\mathcal{O}$ is checked in the category of sets where it follows from that being locally a homogeneous fraction is a local predicate and local predicates define subsheaves. This sheaf is called the structure sheaf of $\operatorname{Proj}\mathcal{A}$, also written as $\mathcal{O}_{\operatorname{Proj} A}$

\paragraph*{Locally ringed space}
\begin{theorem}\label{thm:proj_as_locally_ringed_space}
    The stalk of $(\operatorname{Proj}\mathcal{A}, \mathcal{O})$ at a homogeneous prime relevant ideal $\mathfrak{p}$ is isomorphic to $A^0_\mathfrak{p}$.
\end{theorem}
\begin{proof}
    Let $U\ni\mathfrak{p}$ be an open subset of $\operatorname{Proj}\mathcal{A}$, then a ring homomorphism $\mathcal{O}(U)\to A^0_\mathfrak{p}$ can be defined by evaluation at $\mathfrak p$, i.e. Since $\mathcal{O}_{\operatorname{Proj}\mathcal{A},\mathfrak{p}}=\operatorname{colim}_{\mathfrak{p}\in U}\mathcal{O}(U)$, a ring homomorphism $f:\mathcal{O}_{\operatorname{Proj}\mathcal{A},\mathfrak{p}}\to A^0_f$ is obtained by universal property of colimit. To check that $f$ is an isomorphism, it is sufficient to check bijectivity:
    \begin{itemize}
        \item Let $z_1=\left\langle s_1, U_1\right\rangle, z_2=\left\langle s_2, U_2\right\rangle \in \mathcal{O}_{\operatorname{Proj}\mathcal{A},\mathfrak{p}}$ be such that $f(z_1)=f(z_2) \stackrel{\mathsf{def}}{\iff} s_1(\mathfrak{p})=s_2(\mathfrak{p})$, then by definition of structure sheaf, there is some open subset $\mathfrak{p}\in V\subseteq U_1\cap U_2$ such that $s_1$ and $s_2$ are both constant on $V$. Since $s_1, s_2$ restrict to the same section on $V$, $z_1 = z_2$ hence proving injectivity.
        \item There is a function $A^0_{\mathfrak{p}}\to \mathcal{O}_{\operatorname{Proj}\mathcal{A},\mathfrak{p}}$ defined by $\frac a b\mapsto \left\langle D(b), x\mapsto \frac a b\right\rangle$, this function is in fact a right inverse to $f$.
    \end{itemize}
\end{proof}

Since $A^0_{\mathfrak{p}}$ is a local ring for any homogeneous prime ideal $\mathfrak{p}$, it can be concluded that $(\operatorname{Proj}\mathcal{A},\mathcal{O}_{\operatorname{Proj}\mathcal{A}})$ is a locally ringed space.

\paragraph*{Affine cover}

\begin{lemma}\label{lemma:choose_basic_open}
    For any $x\in \operatorname{Proj}\mathcal{A}$, there is some $0 < m \in \mathbb{N}$ and $f\in \mathcal{A}_m$, such that $x\in D(f)\stackrel{\mathsf{def}}{\iff}f\not\in x$.
\end{lemma}
\begin{proof}
    Let $x\in \operatorname{Proj}\mathcal A$, by construction, $\bigoplus_{i=1}^\infty\mathcal{A}_i\not\subseteq x$. Thus there is some $f=f_1+f_2+\dots\not\in x$, then at least one $f_i\not\in x$ for otherwise $f\in x$.
\end{proof}

Thus, to construct an affine cover, it is sufficient to prove that for all $0<m\in \mathbb{N}$ and homogeneous element $f\in\mathcal{A}_m$, $(D(f),\mathcal{O}_{\operatorname{Proj}\mathcal{A}}\!\mid_{D(f)})\cong (\operatorname{Spec} A^0_f, \mathcal{O}_{\operatorname{Spec} A^0_f})$ where $A^0_f$ is the subring of the localised ring $A_f$ consisted of elements of degree zero. Now fix these notations, an isomorphism between locally ringed space is a pair $(\phi, \alpha)$ where $\phi$ is a homeomorphism between topological space $D(f)\cong\operatorname{Spec}A^0_f $ and $\alpha$ an isomorphism between
$\phi_*(\mathcal{O}_{\operatorname{Proj}\mathcal{A}}\!\mid_{D(f)})\cong \mathcal{O}_{\operatorname{Spec}A^0_f}$.

\begin{theorem}\label{thm:homeomorph}
    $D(f)\cong \operatorname{Spec}A^0_f$ are homeomorphic as topological spaces.
\end{theorem}
The following proofs are an expansion of \cite[II.2.5]{hartshorne1977graduate} while drawing ideas from \cite[II.4.5]{vakil24rising}.

\begin{proof}
    Define $\phi: D(f) \to\operatorname{Spec}A^0_f$ by
    $\mathfrak{p}\mapsto\operatorname{span}\left\{\frac{g}1\mid g\in\mathfrak{p}\right\}\cap A^0_f$; by clearing denominators, one can show that $\phi(\mathfrak{p})=\operatorname{span}\left\{\frac g{f^i}|g\in \mathfrak p\cap A_{mi}\right\}$. One can check that $\phi(\mathfrak{p})$ is indeed a prime ideal.
        % \item $1\not\in\phi(\mathfrak{p})$: for otherwise
        % $1 = \sum_i\frac{a_i}{f^{n_i}}\frac {g_i}1$,
        % by multiplying a suitable power of $f$,
        % $\frac{f^N} 1 = \frac{\sum_i a_i g_i f^{k_i}}1$ for some $N$; by definition of localisation,  $f^M f^N=f^M \sum_i a_i g_i f^{k_i}$ for some $M$, since the right hand side is in $\mathfrak p$, the left hand side is in $\mathfrak p$ too, implying $f\in\mathfrak p$. Contradiction.
        % \item If $x_1 x_2\in =\phi(\mathfrak p)$, then either $x_1\in\phi(\mathfrak p)$ or $x_2 \in \phi(\mathfrak p)$: write $x_1=\frac{a_1}{f^{n_1}}$ and $x_2=\frac{a_2}{f^{n_2}}$, then $\frac{a_1a_2}{f^{n_1+n_2}}\in\mathrm{span}\left\{\frac g1|g \in \mathfrak p\right\}$, so write
        % $\frac{a_1a_2}{f^{n_1+n_2}}=\sum_i \frac{c_i}{f^{n_i}}\frac{g_i}1$,
        % by multiplying a suitable power of $f$, we get
        % $
        % \frac{a_1a_2f^N}1=\frac{\sum_i c_ig_if^{k_i}}1
        % $ for some $N$, then by definition of localisation, $a_1a_2f^N f^M=f^M\sum_i c_ig_if^{k_i}$ for some $M$, since right handside is in $\mathfrak p$ and $f\not\in\mathfrak p$, either $a_1\in\mathfrak p$ or $a_2\in\mathfrak p$.
        $\phi$ is continuous by checking on the topological basis consisting of basic open sets of $\operatorname{Spec}A^0_f$. The fact that basic open sets form a basis is already recorded in \textsf{mathlib} \cite{mathlibrepo}. Take $\frac{a}{f^n}\in A^0_f$, then $\phi^{-1}\left(D\left(\nicefrac a{f^n}\right)\right)=D(f)\cap D(a)$. 
        \begin{itemize}
            \item $D(f)\cap D(a)\subseteq \phi^{-1}\left(D\left(\nicefrac a{f^n}\right)\right)$ because if $y\in D(f)\cap D(a)$ and $\nicefrac a{f^n}\in \phi(y)$, i.e.
            $
            \nicefrac a{f^n}=\sum_i \nicefrac{c_i}{f^{n_i}}\nicefrac{g_i}1,
            $
            then by multiplying suitable powers of $f$,
            $
            \nicefrac{a f^N}1=\nicefrac{\sum_i c_ig_if^{m_i}}1
            $ for some $N$, by definition of localisation, $af^N f^M=\sum_i c_i g_i f^{m_i}$ for some $M$ implying that $a\in y$. Contradiction.
            \item On the other hand, if $\phi(y)\in D\left(\nicefrac a{f^n}\right)$ and $a\in y$, then $\nicefrac a 1\in h(y)$, contradiction because $\nicefrac a{f^n}=\nicefrac a1\nicefrac1{f^n}\in \phi(y)$.
        \end{itemize}
        % since $\mathrm{Spec}A^0_f$ also has a topological basis of basic open sets, it suffices to check that preimages of basic open sets are open. Take $\frac{a}{f^n}\in A^0_f$, then $\phi^{-1}\left(D\left(\frac a{f^n}\right)\right)=D(f)\cap D(a)$. 
        % \begin{itemize}
        %     \item $D(f)\cap D(a)\subseteq \phi^{-1}\left(D\left(\frac a{f^n}\right)\right)$ because if $y\in D(f)\cap D(a)$ and $\frac a{f^n}\in \phi(y)$, i.e.
        %     $
        %     \frac a{f^n}=\sum_i \frac{c_i}{f^{n_i}}\frac{g_i}1,
        %     $
        %     then by multiplying suitable powers of $f$,
        %     $
        %     \frac{a f^N}1=\frac{\sum_i c_ig_if^{m_i}}1
        %     $ for some $N$, by definition of localisation, $af^N f^M=\sum_i c_i g_i f^{m_i}$ for some $M$ implying that $a\in y$. Contradiction.
        %     \item On the other hand, if $\phi(y)\in D\left(\frac a{f^n}\right)$ and $a\in y$, then $\frac a 1\in h(y)$, contradiction because $\frac a{f^n}=\frac a1\frac1{f^n}\in \phi(y)$.
        % \end{itemize}
    For the other direction, define $\psi: \operatorname{Spec} A^0_f\to{D(f)}$ to be $x \mapsto \left\{a\mid\text{for all $i\in\mathbb N$, $\frac{a_i^m}{f^i}\in x$}\right\}$. 
    For $\psi$ to be well-defined, one needs to check that $\psi(x)$ is a homogeneous prime ideal that is relevant. Continuity of $\psi$ depends on that $\phi$ and $\psi$ are inverse to each other.
    % The following can be checked:
    % \begin{itemize}
    %     \item $0\in \psi(x)$ for obvious reason.
    %     \item if $a,b\in \psi(x)$, then $a + b\in \psi(x)$: since $x$ is prime, it is sufficient to show
    %         $\left(\frac{(a_i+b_i)^m}{f^i}\right)^2 = \sum_{j=0}^{2m}{2m\choose j}\frac{a_i^j b_i^{2m-j}}{f^{2i}}\in x$.
    %     if $m\le j$, write
    %     $
    %     \frac{a_i^j b_i^{2m-j}}{f^{2i}} = \boxed{\frac{a_i^m}{f^i}}\frac{a_i^{j-m}b_i^{2m-j}}{f^i},
    %     $
    %     otherwise, write
    %     $
    %     \frac{a_i^j b_i^{2m-j}}{f^{2i}} =\boxed{\frac{b_i^m}{f^i}}\frac{a_i^jb_i^{m-j}}{f^i}.
    %     $
    %     By assumption, the boxed parts are both in $x$, thus $\left(\frac{(a_i+b_i)^m}{f^i}\right)^2$ is also in $x$.
    %     \item if $a, b \in A$ and $b\in \psi(x)$, then $ab\in \psi(x)$: inducting on $a$, one obtain that
    %     \begin{itemize}
    %         \item if $a = 0$, then $(ab)_i=0$;
    %         \item if $a\in \mathcal{A}_n$ and $n\le i$ then $(ab)_i=ab_{n-i}$;
    %         \item if the result hold for $a, a'$, then $(a+a')b=ab+a'b\in \psi(x)$.
    %     \end{itemize}
    %     \item $\psi(x)$ is homogeneous: if $a\in \psi(x)$ then for any $i\in\mathbb N$, $a_i\in \psi(x)$, because $\left(a_i\right)_j=a_i$ or $0$ for all natural number $j$.
    %     \item $\psi(x)$ is prime: for a homogeneous ideal, prime condition is equivalent to being homogeneously prime, i.e. $\mathfrak p$ is prime if and only if $1\not\in\mathfrak p$ and for any $a\in A_i$ and $b\in A_j$, $ab\in\mathfrak p$ implies $a\in\mathfrak p$ or $b\in\mathfrak p$.  $1\not\in\psi(x)$ for the first projection of $1$ is $1$ which is not $x$. Suppose $a\in A_i$ and $b\in A_j$, suppose $a,b\not\in \psi(x)$ then $\frac{a_n^m}{f^n}\not\in x$ for some $n\in\mathbb N$ and $\frac{b_k^m}{f^k}\not\in x$ for some $k\in\mathbb N$. Then $n=i$ for otherwise $0\not\in x$ and similarly $k=j$. So $\frac{(ab)_{i+j}^m}{f^{i+j}}=\frac{a_i^m}{f^i}\frac{b_j^m}{f^j}\not\in x$.
    %     \item  $\psi(x)$ is relevant: for otherwise $\bigoplus_{1\le i}\mathcal{A}_i\subseteq \psi(x)$ then $f\not\in \psi(x)$, for otherwise $1=\frac{f_m^m}{f^m}\in x$, a contradiction; however $f\in\bigoplus_{1\le i}\mathcal{A}_i$, since $f_0=0$.
    % \end{itemize}
    % $\psi$ being continuous depends on that $\psi$ and $\phi$ are inverses to each other:
    % \begin{itemize}
    %     \item $\phi\circ \psi=1$:
    %     \begin{itemize}
    %         \item $\phi(\psi(x))\subseteq x$: if $z\in \phi(\psi(x))$ then $z\in\mathrm{span}\left\{\frac c{f^i}|c\in g(x)\cap A_{mi}\right\}$. So $z$ can be written as
    %         $z=\sum_i \frac{a_i}{f^{n_i}}\frac{c_i}{f^{k_i}}$;
    %         since $c_i\in \psi(x)\cap A_{mk_i}$, $\frac{c_i^m}{f^{mk_i}}\in x$ implying that $\frac{c_i}{f^{k_i}}\in x$ and $z \in x$.
    %         \item $x\subseteq \phi(\psi(x))$: if $\frac{a}{f^k} \in x$ for $a\in A_{mk}$, then $a\in \psi(x)$ for $\frac{a_i^m}{f^i}=\frac{a^m}{f^{mk}}=\left(\frac{a}{f^k}\right)^m\in x$ if $i=mk$ or $0$ otherwise. Thus $\frac{a}{f^k}\in\mathrm{span}\left\{\frac c1|c \in g(x)\right\}\cap A^0_f$ since $\frac{a}{f^k}=\frac a 1\frac1{f^k}$.
    %     \end{itemize}
    %     \item $\psi\circ \phi=1$:
    %     \begin{itemize}
    %         \item $\psi(\phi(x))\subseteq x$: let $z\in \psi(\phi(x))$ and $i$ be a natural number, since $\frac{z_i^m}{f^i}\in \phi(x)$, $\frac{z_i^m}{f^i}$ can be written as $\sum_j\frac{c_j}{f^{n_j}}\frac{d_j}1$
    %         with $d_j\in x$, by multiplying a suitable power of $f$,
    %         $z_i^mf^N=\sum_jc_jd_jf^{N_j}$ for some $N$ implying that $z_i\in x$.
    %         \item $x\le \psi(\phi(x))$: if $z\in x$, then $z_i\in x$ for all natural number $i$ by homogeneity. So $\frac{z_i^m}{f^i}=\frac1{f^i}\left(\frac{z_i}1\right)^m\in \phi(x)$ because $\frac{z_i}1\in \phi(x)$.
    %     \end{itemize}
    % \end{itemize}
    % Thus $\phi$ and $\psi$ are both bijections implying that $\psi$ is continuous as well: 
    ${D(f)}$ with the subspace topology has a basis of the form $D(f)\cap D(a)$, thus it is sufficient to prove that preimages of these sets are open. By considering $\phi(D(f)\cap D(a))=\bigcup_i \phi(D(f)\cap D(a_i))$, each $\phi(D(f)\cap D(a_i))$ is open because $\phi(D(f)\cap D(a_i))=D\left(\nicefrac{a_i^m}{f^i}\right)$ in $\mathrm{Spec} A^0_f$. To prove $\phi(D(f)\cap D(a_i))=D\left(\nicefrac{a_i^m}{f^i}\right)$, it is sufficient to prove $\phi^{-1}(D\left(\nicefrac{a_i^m}{f^i}\right))=D(f)\cap D(a)$ and this proven in continuity of $\phi$. Since $\phi$ and $\psi$ are inverses to each other, preimage of $D(f)\cap D(a)$ is indeed $\phi(D(f)\cap D(a))$.
    % Thus we have proven that $\phi: D(f)\cong \mathrm{Spec} A^0_f$ as topological spaces.
\end{proof}

Let $\phi$ and $\psi$ be the continuous functions defined in the previous proof, $U$ be an open subset of $\operatorname{Spec}A^0_f$, $s$ be a section on $\phi^{-1}(U)$ and $x \in U$, then $\psi(x)\in \phi^{-1}(U)$, hence $s(\psi(x))=\frac n d\in A^0_{\psi(x)}$ for some $i\in\mathbb{N}$ and $n, d \in \mathcal{A}_i$. Keeping the same notation, a ring homomorphism $\alpha_U:\phi_*(\mathcal O_{\mathrm{Proj}}\!\mid_{D(f)})(U)\to \mathcal O_{\mathrm{Spec}A^0_f}(U)$ can be defined as $s\mapsto \left(x\mapsto \frac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}\right)$ where $n, d\in\mathcal{A}_i$.  Assuming $\alpha_U$ is well-defined, it is easy to check that $U\mapsto \alpha_U$ is natural in $U$, hence $\alpha$ defines a morphism of sheaves \footnote{In fact, \lstinline{simp} can do this.}.
% Assuming that $\alpha$ is indeed a ring homomorphism, it is easy to check that the following diagram commutes whenever $V\subseteq U$:
% $$
% \begin{CD} 
%     \mathcal O_{\mathrm{Proj}\mid_{D(f)}}(h^{-1}(U)) @>{\alpha_U}>> \mathcal O_{\mathrm{Spec}A^0_f}(U) \\
%     @VVV                                                           @VVV                              \\
%     \mathcal O_{\mathrm{Proj}\mid_{D(f)}}(h^{-1}(V)) @>{\alpha_V}>> \mathcal O_{\mathrm{Spec}A^0_f}(V)
% \end{CD}.
% $$
\begin{lemma}\label{thm:def-alpha}
    For any open subset $U\subseteq \operatorname{Spec}A^0_f$, $\alpha_U$ is well-defined; hence $\alpha$ defines a morphism of sheaves.
\end{lemma}
\begin{proof}
    It is clear that both the numerator and denominator have degrees zero. $\nicefrac{d^m}{f^i}\not\in x$ follows from $d\not\in\psi(x)$.
    $\alpha_U(s)$ is locally a fraction: since $s$ is locally a quotient, for any $x\in U$, there is some open set $V\subseteq \mathrm{Proj}\mathcal{A}$ such that $\psi(x)\in V\subseteq \phi^{-1}(U)$ such that $s(y)=\frac a b$ for all $y\in V$ where $a,b\in A_n$ and $b\not\in y$, then to check $\alpha_U(s)$ is locally quotient, use the open subset $\phi(V)$ and check that for all $z\in \phi(V)$, $\alpha_U(s)(z)=\frac{ab^{m-1}}{b^m}$. The proof of $\alpha_U$ being a ring homomorphism involves manipulations of fractions in localised rings, for more details, see \Cref{sec:formalisation}. % 
    % \begin{itemize}
    %     \item $\alpha_U$ preserves one: let $x\in U$, suppose $1=\alpha_U(1)(x)=\frac n d$ where $n,d\in A_i$, by definition of localisation, for some $c\not\in \psi(1)$, $nc=dc$. Since $c\not\in \psi(1)$, there is some $j\in\mathbb N$, $\frac{c_j^m}{f^j}\not\in x$. Then $(nc)_{i+j}=(dc)_{i+j}=nc_j=dc_j$. Hence
    %     $$
    %     \frac{c_j^m}{f^j}\frac{nd^{m-1}}{f^i}=\frac{c_j^mnd^{m-1}}{f^{i+j}}=\frac{(dc_j)^m}{f^{i+j}}=\frac{c_j^m}{f^j}\frac{d^m}{f^i},
    %     $$
    %     i.e. $\alpha_U(1)(x)=1$ for all $x$. Similarly, $\alpha_U$ preserves zero as well.
    %     \item $\alpha_U$ preserves addition: let $s_1, s_2$ be two sections and $x\in U$, write $s_1(\psi(x))=\frac{n_1}{d_1}$ with $n_1,d_1\in A_{i_1}$, $s_2(\psi(x))=\frac{n_2}{d_2}$ with $n_2, d_2\in A_{i_2}$ and $(s_1+s_2)(\psi(x))=\frac{n_{12}}{d_{12}}=\frac{n_1}{d_1}+\frac{n_2}{d_2}$ with $n_{12}, d_{12}\in A_{i_{12}}$. Thus it is sufficient to check
    %     $$
    %     \frac{\nicefrac{n_{12}d_{12}^{m-1}}{f^{i_{12}}}}{\nicefrac{d_{12}^m}{f^{i_{12}}}}=\frac{\nicefrac{n_1d_1^{m-1}}{f^{i_1}}}{\nicefrac{d_1^m}{f^{i_1}}} + \frac{\nicefrac{n_2d_2^{m-1}}{f^{i_2}}}{\nicefrac{d_2^m}{f^{i_2}}}.
    %     $$
        
    %     From $\frac{n_{12}}{d_{12}}=\frac{n_1}{d_1}+\frac{n_2}{d_2}=\frac{n_1d_2+n_2d_1}{d_1d_2}$, so we can find a $c\not\in \psi(x)$, such that 
    %     $$
    %     n_{12}d_1d_2c=(n_1d_2+n_2d_1)d_{12}c.
    %     $$
    %     Since $c\not\in \psi(x)$, there is some $j\in\mathbb N$ such that $\frac{c_j^m}{f^j}\not\in x$. Then by taking the $i_1+i_2+i_{12}+j$-th projection $n_{12}d_1d_2c_j=(n_1d_2+n_2d_1)d_{12}c_j$, implying the desired equality by multiplying $\nicefrac{c_j^m}{f^j}$. Using this, one can check that by multiplying $\frac{c_j^m}{f^j}$, the desired equality can be proved. Similarly, $\alpha_U(s_1s_2)(x)=\alpha_U(s_1)(x)\alpha_U(s_2)(x)$.
    % \end{itemize}
\end{proof}

In the other direction, if $s\in \mathcal O_{\mathrm{Spec}A^0_f}(U)$ and $y\in \phi^{-1}(U)$, then $\phi(y)\in U$, so $s(\phi(y))$ can be written as $\frac{a}{b}$ where $a,b\in A^0_f$; then $a$ can be written as $\frac{n_a}{f^{i_a}}$ for some $n_a\in A_{mi_a}$ and $b$ as $\frac{n_b}{f^{i_b}}$ for some $n_b\in A_{mi_b}$. Hence, a ring homomorphism $\beta_U: \mathcal O_{\mathrm{Spec}A^0_f}(U)\to \mathcal O_{\mathrm{Proj}}\!\mid_{D(f)}(\phi^{-1}(U))$ can be defined as $s\mapsto \left(y \mapsto \frac{n_af^i_b}{n_bf^{i_a}}\right)$. Assuming $\beta$ is well defined, it is easy to check that the assignment $U\mapsto \beta_U$ is natural so that $\beta$ is a natural transformation \footnote{In fact, \lstinline{simp} can do this.}.

\begin{lemma}\label{thm:def-beta}
    For any open subset $U\subseteq \operatorname{Spec}A^0_f$, $\beta_U$ is well-defined; hence $\beta$ defines a morphism of sheaves.
\end{lemma}
\begin{proof}
    $n_af_b^{i_b}$ and $n_bf^{i_a}$ have the same degree. $n_bf^{i_a}\not\in y$ follows from $b\not\in\phi(y)$. Since $s$ locally is a fraction, there are open sets $\phi(y)\in V\subseteq U$, such that for all $z\in V$, $s(z)$ is $\frac{\nicefrac{a}{f^{l_1}}}{\nicefrac{b}{f^{l_2}}}$. Then on $\phi^{-1}(V)\subseteq \phi^{-1}(U)$, $\psi_U(s)(y)$ is always $\frac{af^{l_2}}{bf^{l_1}}$. Checking that $\beta_U$ is a ring homomorphism involves manipulating fractions of fractions. 
    % Then it is sufficient to check that $\beta_U$ is a ring homomorphism:
    % \begin{itemize}
    %     \item $\beta_U$ preserves one. Suppose $\frac11=1(\phi(y))=\frac a b$ for some $a,b\in A^0_f$, then by definition of localisation, there is some $\frac c{f^l}\not\in \phi(y)$ such that $$\frac {n_ac}{f^{i_a+l}}=\frac {n_bc}{f^{i_b+l}};$$ by definition of localisation again, there is some $n_1\in\mathbb N$ such that $$n_acf^{i_b+l+n_1}=n_bcf^{i_a+l+n_1}.$$ Hence $\beta_U(1)(y)=\frac{n_af^{b_i}}{n_bf^{i_a}}=1$.
    %     Similarly, $\beta_U$ preserves zero as well. 
    %     \item $\beta_U$ preserves multiplication, let $s_1, s_2$ be two sections and $y\in\phi^{-1}(U)$, by writing 
    %     $s_1(\phi(y))$ as $\frac{\nicefrac{a_1}{f^{i_1}}}{\nicefrac{b_1}{f^{j_1}}}$, $s_2(\phi(y))$ as $\frac{\nicefrac{a_2}{f^{i_2}}}{\nicefrac{b_2}{f^{i_2}}}$ and $(s_1s_2)(\phi(y))=\frac{\nicefrac{a_{12}}{f^{i_{12}}}}{\nicefrac{b_{12}}{f^{j_{12}}}}$, one deduces that $\frac{\nicefrac{a_1a_2}{f^{i_1+i_2}}}{\nicefrac{b_1b_2}{f^{j_1+j_2}}}=\frac{\nicefrac{a_{12}}{f^{i_{12}}}}{\nicefrac{b_{12}}{f^{j_{12}}}}$, by definition of localisation, it implies that, there is some $\frac{c}{f^l}$ such that $$\frac{a_1a_2b_{12}c}{f^{i_1+i_2+j_{12}+l}}=\frac{a_{12}b_1b_2c}{f^{i_{12}+j_1+j_2+l}}.$$ Hence, there is some $L\in\mathbb N$, such that 
    %     $$a_1a_2b_{12}cf^{i_{12}+j_1+j_2+l+L}=a_{12}b_1b_2cf^{i_1+i_2+j_{12}+l+L},$$ implying that
    %     $$
    %     \frac{a_{12}f^{j_{12}}}{b_{12}f^{i_{12}}}=\frac{a_1f^{j_1}}{b_1f^{i_1}}\cdot\frac{a_2f^{j_2}}{b_2f^{i_2}}.
    %     $$ Similarly, $\beta_U$ preserves addition as well. 
    % \end{itemize}
\end{proof}

\begin{theorem}\label{thm:iso-sheaf}
    $\phi_*(\mathcal{O}_{\operatorname{Proj}\mathcal{A}}\!\mid_{D(f)})$ and $\mathcal{O}_{\operatorname{Spec}A^0_f}$ are isomorphic as sheaves.
\end{theorem}
\begin{proof}
    By combining \Cref{thm:def-alpha} and \Cref{thm:def-beta}, it is sufficient to check $\alpha \circ \beta$ and $\beta \circ \alpha$ are both identities. 
    \begin{itemize}
        \item $\beta\circ\alpha=1$: let $s\in\mathcal O_{\mathrm{Proj}}\!\mid_{D(f)}(\phi^{-1}(U))$, then for $x\in \phi^{-1}(U)$
        $$
        \alpha_U(s)=x\mapsto \frac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}},
        $$
        where $s(x)=\frac n d$.
        Thus, by definition
        $$
        \beta_U(\alpha_U(s))(x)=\frac{nd^{m-1}f^i}{d^mf^i}=\frac n d=s(x).
        $$
        \item $\alpha\circ\beta=1$: let $s\in\mathcal O_{\mathrm{Spec}A^0_f}(U)$, then for $x\in U$
        $$
        \beta_U(s)=x\mapsto \frac{n_af^{i_b}}{n_bf^{i_a}}
        $$
        where 
        $s(x)=\frac{\nicefrac{n_a}{f^{i_a}}}{\nicefrac{n_b}{f^{i_b}}}.$ Thus
        $$
        \phi_U(\psi_U(s))(x)=\frac{\nicefrac{n_af^{i_b}\left(n_bf^{i_a}\right)^{m-1}}{f^{j}}}{\nicefrac{\left(n_bf^{i_a}\right)^m}{f^{j}}}=\frac{\nicefrac{n_a}{f^{i_a}}}{\nicefrac{n_b}{f^{i_b}}}=s(x).
        $$
    \end{itemize}
\end{proof}

\begin{corollary}\label{thm:proj-scheme}
    $(\operatorname{Proj}\mathcal{A}, \mathcal{O}_{\operatorname{Proj}\mathcal{A}})$ is a scheme.
\end{corollary}

\section{Formalisation details}\label{sec:formalisation}

\subsection{Homogeneous Ideal}
Let $A$ be an $R$-algebra and an $\iota$-grading $\mathcal{A} : \iota\to R\text{-submodules of~} A$ \cite{wieser2022graded}, \lstinline{ideal.is_homogeneous} is the proposition of an ideal being homogeneous and \lstinline{homogeneous_ideal} is the type of all homogeneous ideals of $A$. Note that, by this implementation, homogeneous ideals are not literally ideals, for this reason, $\operatorname{Proj} \mathcal{A}$ cannot be implemented as a subset of $\operatorname{Spec} A$.
\begin{lstlisting}
def ideal.is_homogeneous : Prop :=
∀ (i : ι) ⦃r : A⦄, r ∈ I → (direct_sum.decompose 𝒜 r i : A) ∈ I

structure homogeneous_ideal extends submodule A A :=
(is_homogeneous' : ideal.is_homogeneous 𝒜 to_submodule)

def homogeneous_ideal.to_ideal (I : homogeneous_ideal 𝒜) : ideal A := I.to_submodule

lemma homogeneous_ideal.is_homogeneous (I : homogeneous_ideal 𝒜) :
  I.to_ideal.is_homogeneous 𝒜 := I.is_homogeneous'

def homogeneous_ideal.irrelevant : homogeneous_ideal 𝒜 :=
⟨(graded_ring.proj_zero_ring_hom 𝒜).ker, sorry⟩
\end{lstlisting}

\subsection{Homogeneous Localisation}
If $x$ is a multiplicatively closed subset, then the homogeneous localisation of $A$ at $x$ is defined to be the subring of localised ring $A_x$ consisting of elements of degree zero. This ring is implemented as triples $\{(i, a, b) : \iota\times \mathcal{A}_i\times \mathcal{A}_i\mid b\not\in x\}$ under the equivalence relation that $(i_1, a_1, b_1)\approx(i_2, a_2, b_2)\stackrel{\mathsf{def}}{\iff}\frac {a_1}{b_1} = \frac{a_2}{b_2}$ in $A_x$. This approach gives an induction principle via quotients, though the construction still uses classical reasoning, many lemmas will be automatic because of rich APIs in \textsf{mathlib} about quotient spaces already; compared to the subring approach, one would need to write corresponding lemmas manually by excessively invoking \lstinline{classical.some} and \lstinline{classical.some_spec}. One potential benefit of the subring approach is that different propositions can be specified for different multiplicative subsets to customize what properties and attributes are to be made explicit; for example for localisation away from a single element, it is useful to make powers of denominator explicit. But this would sacrifice a universal approach to homogeneous localisation for different multiplicative subsets so that auxiliary lemmas would have to be duplicated. To maintain consistency and prevent duplication, this paper will adopt the approach from quotient space. Before writing this paper, the subring approach has also been tested, by comparing the two approaches, it proves that there is no significant difference in the smoothness of two formalisations but the quotienting approach has smaller code sizes. 

\begin{lstlisting}
variables {ι R A: Type*} [add_comm_monoid ι] [decidable_eq ι]
variables [comm_ring R] [comm_ring A] [algebra R A]
variables (𝒜 : ι → submodule R A) [graded_algebra 𝒜]
variables (x : submonoid A)

structure num_denom_same_deg :=
(deg : ι) (num denom : 𝒜 deg) (denom_mem : (denom : A) ∈ x)

def embedding (p : num_denom_same_deg 𝒜 x) : localization x :=
localization.mk p.num ⟨p.denom, p.denom_mem⟩

def homogeneous_localization : Type* := quotient (setoid.ker $ embedding 𝒜 x)
\end{lstlisting}

Then if \lstinline{(y : homogeneous_localization 𝒜 x)}, its value, degree, numerator and denominator can all be defined by using induction/recursion principles for quotient spaces:
\begin{lstlisting}
variable (y : homogeneous_localization 𝒜 x)
 
def val : localization x :=
  quotient.lift_on' y (num_denom_same_deg.embedding 𝒜 x) $ λ _ _, id

def num : A := (quotient.out' y).num
def denom : A := (quotient.out' y).denom
def deg : ι := (quotient.out' y).deg

lemma denom_mem : y.denom ∈ x := (quotient.out' y).denom_mem
lemma num_mem_deg : y.num ∈ 𝒜 f.deg := (quotient.out' y).num.2
lemma denom_mem_deg : y.denom ∈ 𝒜 y.deg := (quotient.out' y).denom.2
lemma eq_num_div_denom : y.val = localization.mk y.num ⟨y.denom, y.denom_mem⟩ := 
sorry
\end{lstlisting}

\subsection{Zariski Topology}
In this section $A$ will be graded by $\mathbb{N}$ and the grading denoted by $\mathcal{A}$. $\operatorname{Proj}\mathcal{A}$ is formalised a structure:

\begin{lstlisting}
structure projective_spectrum :=
(as_homogeneous_ideal : homogeneous_ideal 𝒜)
(is_prime : as_homogeneous_ideal.to_ideal.is_prime)
(not_irrelevant_le : ¬(homogeneous_ideal.irrelevant 𝒜 ≤ as_homogeneous_ideal))
\end{lstlisting}

After building more APIs around \lstinline{projective_spectrum}, Zariski topology with a basis of basic open sets can be formalised as:
\begin{lstlisting}
def zero_locus (s : set A) : set (projective_spectrum 𝒜) :=
{x | s ⊆ x.as_homogeneous_ideal}

instance zariski_topology : topological_space (projective_spectrum 𝒜) :=
topological_space.of_closed (set.range (zero_locus 𝒜)) sorry sorry sorry

def basic_open (r : A) : topological_space.opens (projective_spectrum 𝒜) :=
{ val := { x | r ∉ x.as_homogeneous_ideal }, 
  property := ⟨{r}, set.ext $ λ x, set.singleton_subset_iff.trans $ not_not.symm⟩ }

lemma is_topological_basis_basic_opens : topological_space.is_topological_basis
  (set.range (λ (r : A), (basic_open 𝒜 r : set (projective_spectrum 𝒜)))) := 
sorry
\end{lstlisting}

\subsection{Locally Ringed Space}
\textsf{mathlib} provides \lstinline{Top.presheaf.is_sheaf_iff_is_sheaf_comp} to check sheaf condition by composing a forgetful functor and \lstinline{Top.subsheaf_to_Types} to construct subsheaf of types satisfying a local predicate \cite{mathlibrepo}; $\mathcal{O}_{\operatorname{Spec}}$ in \textsf{mathlib} adopted this approach \cite{mathlibrepo}, and structure sheaf of $\operatorname{Proj}$ will also be constructed in this way. \lstinline{is_locally_fraction} is a local predicate expressing ``being locally a homogeneous fraction'' in \Cref{sec:proj_construction_maths}:

\begin{lstlisting}
def is_fraction {U : opens (Proj 𝒜)} (f : Π x : U, (*@ $\mathtt A^0_{\mathtt{x}}$ @*)) : Prop :=
∃ (i : ℕ) (r s : 𝒜 i), ∀ x : U, ∃ (s_nin : s.1 ∉ x.1.as_homogeneous_ideal),
  f x = quotient.mk' ⟨i, r, s, s_nin⟩

def is_fraction_prelocal : prelocal_predicate (λ (x : Proj 𝒜), (*@ $\mathtt A^0_{\mathtt{x}}$ @*)) :=
{ pred := λ U f, is_fraction f,
  res := by rintros V U i f ⟨j, r, s, w⟩; exact ⟨j, r, s, λ y, w (i y)⟩ }

def is_locally_fraction : local_predicate (λ (x : Proj 𝒜), (*@ $\mathtt A^0_{\mathtt{x}}$ @*)) :=
(is_fraction_prelocal 𝒜).sheafify

def structure_sheaf_in_Type : sheaf Type* (Proj 𝒜):=
subsheaf_to_Types (is_locally_fraction 𝒜)
\end{lstlisting}

The presheaf of rings is also defined as \lstinline{structure_presheaf_in_CommRing} and checked that composition with forgetful functor is naturally isomorphic to the underlying presheaf of \lstinline{structure_sheaf_in_Type} which implies that \lstinline{structure_presheaf_in_CommRing} satisfies the sheaf condition as well by using \lstinline{Top.presheaf.is_sheaf_iff_is_sheaf_comp}.
\begin{lstlisting}
def structure_presheaf_in_CommRing : presheaf CommRing (Proj 𝒜) :=
{ obj := λ U, CommRing.of ((structure_sheaf_in_Type 𝒜).1.obj U), ..sorry }

def structure_presheaf_comp_forget :
  structure_presheaf_in_CommRing 𝒜 ⋙ (forget CommRing) ≅ 
  (structure_sheaf_in_Type 𝒜).1 := 
sorry

def Proj.structure_sheaf : sheaf CommRing (Proj 𝒜) :=
⟨structure_presheaf_in_CommRing 𝒜, (is_sheaf_iff_is_sheaf_comp _ _).mpr
  (is_sheaf_of_iso (structure_presheaf_comp_forget 𝒜).symm (structure_sheaf_in_Type 𝒜).cond)⟩
\end{lstlisting}
Then following \Cref{thm:proj_as_locally_ringed_space}, \lstinline{stalk_to_fiber_ring_hom} is a family of ring homomorphism $\prod_x \mathcal{O}_{\operatorname{Proj}\mathcal A, x}\to A^0_x$ obtained by universal property of colimit with its right inverse as a family of function \lstinline{homogeneous_localization_to_stalk}:

\begin{lstlisting}
def stalk_to_fiber_ring_hom (x : Proj 𝒜) :
  (Proj.structure_sheaf 𝒜).presheaf.stalk x ⟶ CommRing.of (*@$\mathtt A^0_{\mathtt{x}}$@*) :=
limits.colimit.desc (((open_nhds.inclusion x).op) ⋙ (Proj.structure_sheaf 𝒜).1) 
  sorry

def section_in_basic_open (x : Proj 𝒜) :
  Π (f : (*@$\mathtt A^0_{\mathtt{x}}$@*)), (Proj.structure_sheaf 𝒜).1.obj (op (Proj.basic_open 𝒜 f.denom)) :=
λ f, ⟨λ y, quotient.mk' ⟨_, ⟨f.num, _⟩, ⟨f.denom,_⟩, _⟩, _⟩

def homogeneous_localization_to_stalk (x : Proj 𝒜) :
  (*@$\mathtt A^0_{\mathtt{x}}$@*) → (Proj.structure_sheaf 𝒜).presheaf.stalk x :=
λ f, (Proj.structure_sheaf 𝒜).presheaf.germ
  (⟨x, homogeneous_localization.mem_basic_open _ x f⟩ : Proj.basic_open _ f.denom)
  (section_in_basic_open _ x f)

def Proj.stalk_iso' (x : Proj 𝒜) :
  (Proj.structure_sheaf 𝒜).presheaf.stalk x ≃+* CommRing.of (*@$\mathtt A^0_{\mathtt{x}}$@*) :=
ring_equiv.of_bijective (stalk_to_fiber_ring_hom _ x)
  ⟨sorry, function.surjective_iff_has_right_inverse.mpr 
    ⟨homogeneous_localization_to_stalk 𝒜 x, sorry⟩⟩
\end{lstlisting}
Hence establishing that $\operatorname{Proj}\mathcal{A}$ is a locally ringed space:
\begin{lstlisting}
def Proj.to_LocallyRingedSpace : LocallyRingedSpace :=
{ local_ring := λ x, @@ring_equiv.local_ring _
    (show local_ring (*@ $\mathtt A^0_{\mathtt{x}}$ @*), from infer_instance) _
    (Proj.stalk_iso' 𝒜 x).symm,
    ..(Proj.to_SheafedSpace 𝒜) }
\end{lstlisting}

\subsection{Affine cover}
\begin{lstlisting}
variables {f : A} {m : ℕ} (f_deg : f ∈ 𝒜 m) (x : Proj| D(f))
\end{lstlisting}
\lstinline{Spec.T} and \lstinline{Proj.T} denotes the topological space associated with each locally ringed spaces. Let $0 < m \in \mathbb N$ and $f\in\mathcal A_m$ and $x \in D(f)$, by following \Cref{thm:homeomorph}, the continuous function $\phi$ and $\psi$ in \Cref{sec:proj_construction_maths} is formalised as \lstinline{Proj_iso_Spec_Top_component.to_Spec} and \lstinline{Proj_iso_Spec_Top_component.from_Spec} respectively; $\phi\circ\psi = 1$ and $\psi\circ\phi = 1$ are recorded as \lstinline{Proj_iso_Spec_Top_component.to_Spec_from_Spec} and \lstinline{.from_Spec_to_Spec} respectively:

\begin{lstlisting}
namespace Proj_iso_Spec_Top_component
namespace to_Spec

def carrier : ideal (*@$\mathtt A^0_{\mathtt{f}}$@*) :=
ideal.comap (algebra_map (*@$\mathtt A^0_{\mathtt{f}}$@*) (*@$\mathtt A_{\mathtt{f}}$@*))
  (ideal.span $ algebra_map A (away f) '' x.val.as_homogeneous_ideal)

def to_fun : Proj.T| D(f) → Spec.T (*@$\mathtt A^0_{\mathtt{f}}$@*) :=
λ x, ⟨carrier 𝒜 x, sorry /-a proof for primeness-/⟩

end to_Spec

def to_Spec (f : A) : Proj.T| D(f) ⟶ Spec.T (*@$\mathtt A_{\mathtt{f}}$@*) :=
{ to_fun := to_Spec.to_fun 𝒜 f,
  continuous_to_fun := begin
    apply is_topological_basis.continuous (Spec.is_topological_basis_basic_opens);
    sorry
  end }

namespace from_Spec

def carrier (q : Spec.T (*@$\mathtt A^0_\mathtt f$@*)) : set A :=
{a | ∀ i, (quotient.mk' ⟨_, ⟨proj 𝒜 i a ^ m, _⟩, ⟨f^i, _⟩, _⟩ : (*@$\mathtt A^0_\mathtt f$@*)) ∈ q.1}

def carrier.as_ideal : ideal A := { carrier := carrier f_deg q, ..sorry }
def carrier.as_homogeneous_ideal : homogeneous_ideal 𝒜 := 
⟨carrier.as_ideal f_deg hm q, sorry⟩

lemma carrier.relevant :
  ¬homogeneous_ideal.irrelevant 𝒜 ≤ carrier.as_homogeneous_ideal f_deg hm q := 
sorry

lemma carrier.as_ideal.prime : (carrier.as_ideal f_deg hm q).is_prime :=
(carrier.as_ideal.homogeneous f_deg hm q).is_prime_of_homogeneous_mem_or_mem 
    sorry sorry

def to_fun : Spec.T (*@$\mathtt A^0_\mathtt f$@*) → Proj.T| D(f) :=
λ q, ⟨⟨carrier.as_homogeneous_ideal f_deg hm q, carrier.as_ideal.prime f_deg hm q,
      carrier.relevant f_deg hm q⟩, sorry⟩

end from_Spec

lemma to_Spec_from_Spec : to_Spec.to_fun 𝒜 f (from_Spec.to_fun f_deg hm x) = x := 
sorry
lemma from_Spec_to_Spec : from_Spec.to_fun f_deg hm (to_Spec.to_fun 𝒜 f x) = x :=
sorry

def from_Spec : Spec.T (*@$\mathtt A^0_{\mathtt f}$@*) ⟶ Proj.T| D(f) :=
{ to_fun := from_Spec.to_fun f_deg hm,
  continuous_to_fun := begin
    apply is_topological_basis.continuous,
    sorry
  end }

end Proj_iso_Spec_Top_component

def Proj_iso_Spec_Top_component:
  Proj.T| D(f) ≅ Spec.T ((*@$\mathtt A^0_{\mathtt f}$@*)) :=
{ hom := Proj_iso_Spec_Top_component.to_Spec 𝒜 f,
  inv := Proj_iso_Spec_Top_component.from_Spec hm f_deg, 
  ..sorry /-composition being identity-/ }
\end{lstlisting}
Continue using notations from \Cref{thm:def-beta}, $\beta$ is formalised as \lstinline{Proj_iso_Spec_Sheaf_component.from_Spec}:
\begin{lstlisting}
namespace Proj_iso_Spec_Sheaf_component
namespace from_Spec

variables (V : (opens (Spec (*@$\mathtt A^0_{\mathtt f}$@*)))ᵒᵖ) (s : (Spec (*@$\mathtt A^0_{\mathtt f}$@*)).presheaf.obj V)
-- This is but a verbose way of spelling y is in (*@$\mathtt{\phi}^{-1}(\mathtt V)$@*) for type checking reasons.
variables (y : ((@opens.open_embedding Proj.T D(f)).is_open_map.functor.op.obj
  ((opens.map (Proj_iso_Spec_Top_component hm f_deg).hom).op.obj V)).unop)
\end{lstlisting}
By evaluation a section $s$, one obtains a family of localizations of $A^0_f$ at prime ideals $y\mapsto s(\phi(y))$, hence obtaining their respective numerators $a=\nicefrac{n_a}{f^{i_a}}$ and denominators $b = \nicefrac{n_b}{f^{i_b}}$ where $s(\phi(y)) = \nicefrac a b$.
\begin{lstlisting}
-- (*@Corresponding to evaluating a section in Lemma \ref{thm:def-beta}.$s(\phi(y))$@*)
def data : structure_sheaf.localizations (*@$\mathtt A^0_{\mathtt f}$@*)
  ((Proj_iso_Spec_Top_component hm f_deg).hom ⟨y.1, _⟩) :=
s.1 ⟨_, _⟩

-- (*@$s(\phi(y))=\frac a b$, this is $a$, see \Cref{thm:def-beta}.@*)
def data.num : (*@$\mathtt A^0_{\mathtt f}$@*) := sorry

-- (*@$s(\phi(y))=\frac a b$, this is $b$, see \Cref{thm:def-beta}@*)
def data.denom : (*@$\mathtt A^0_{\mathtt f}$@*) := sorry
\end{lstlisting}
Thus $\nicefrac{n_af^{i_b}}{n_bf^{i_a}}$ defines an element of $A^0_y$.
\begin{lstlisting}
-- (*@$s\mapsto \left(y \mapsto \nicefrac{n_af^i_b}{n_bf^{i_a}}\right)$, this is $n_af^i_b$,  see \Cref{thm:def-beta}.@*)
def num : A :=
  (data.num _ hm f_deg s y).num * (data.denom _ hm f_deg s y).denom

-- (*@$s\mapsto \left(y \mapsto \nicefrac{n_af^i_b}{n_bf^{i_a}}\right)$, this is $n_bf^{i_a}$,  see \Cref{thm:def-beta}.@*)
def denom : A :=
  (data.denom _ hm f_deg s y).num * (data.num _ hm f_deg s y).denom

  -- (*@$s\mapsto \left(y \mapsto \nicefrac{n_af^i_b}{n_bf^{i_a}}\right)$, this is $\nicefrac{n_af^i_b}{n_bf^{i_a}}$,  see \Cref{thm:def-beta}.@*)
def bmk : (*@$\mathtt A^0_{\mathtt y}$@*) :=
quotient.mk'
{ deg := (data.num _ hm f_deg s y).deg + (data.denom _ hm f_deg s y).deg,
  num := ⟨num hm f_deg s y, _⟩,
  denom := ⟨denom hm f_deg s y, _⟩,
  denom_mem := sorry }

def to_fun.aux : ((Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f)).presheaf).obj V :=
⟨bmk hm f_deg V s, sorry /-being locally a homogeneous fraction-/⟩

def to_fun : (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf.obj V ⟶
  ((Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f)).presheaf).obj V :=
{ to_fun := λ s, to_fun.aux 𝒜 hm f_deg V s, ..sorry /-ring homomorphism proofs-/ }

end from_Spec
\end{lstlisting}
After checking being a homomorphism and locally a fraction, one obtain a morphism between sheaves.
\begin{lstlisting}
def from_Spec : (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf ⟶
  (Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f)).presheaf :=
{ app := λ V, from_Spec.to_fun 𝒜 hm f_deg V,
  naturality' := λ _ _ _, by { ext1, simpa } }

end Proj_iso_Spec_Sheaf_component
\end{lstlisting}

With notations in \Cref{thm:def-alpha}, $\alpha$ is formalised as \lstinline{Proj_iso_Spec_Sheaf_component.to_Spec}. By evaluating a section $s$, one obtains a family $y\mapsto s(\psi(y))=\nicefrac{n}{d}$ of homogeneous localisations at $\psi(y)$. Then $x\mapsto \frac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}$ defines an element in the localised ring of $A^0_f$ at $y$.
\begin{lstlisting}
namespace Proj_iso_Spec_Sheaf_component
namespace to_Spec
variable (U : (opens (Spec.T (*@$\mathtt A^0_ \mathtt f$@*)))ᵒᵖ)
variable (s : ((Proj_iso_Spec_Top_component hm f_deg).hom _* 
    (Proj| D(f))).presheaf.obj U) -- (*@$(\phi_* (\mathcal{O}_{\operatorname{Proj}}\!\mid_{D(f)}))(U)$@*)

def hl (y : unop U) : homogeneous_localization 𝒜 _ :=
s.1 ⟨((Proj_iso_Spec_Top_component hm f_deg).inv y.1).1, _⟩

-- (*@$s\mapsto \left(x\mapsto \nicefrac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}\right)$ where $n, d\in\mathcal{A}_i$, this is $\nicefrac{nd^{m-1}}{f^i}$, see \Cref{thm:def-alpha}.@*)
def num (y : unop U) : (*@$\mathtt A^0_ \mathtt f$@*) :=
quotient.mk'
{ deg := m * (hl hm f_deg s y).deg,
  num := ⟨(hl hm f_deg s y).num * (hl hm f_deg s y).denom ^ m.pred, _⟩,
  denom := ⟨f^(hl hm f_deg s y).deg, _⟩,
  denom_mem := _ }

-- (*@$s\mapsto \left(x\mapsto \nicefrac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}\right)$ where $n, d\in\mathcal{A}_i$, this is $\nicefrac{d^m}{f^i}$, see \Cref{thm:def-alpha}.@*)
def denom (y : unop U) : (*@$\mathtt A^0_ \mathtt f$@*) :=
quotient.mk'
{ deg := m * (hl hm f_deg s y).deg,
  num := ⟨(hl hm f_deg s y).denom ^ m, _⟩,
  denom := ⟨f ^ (hl hm f_deg s y).deg,_⟩,
  denom_mem := _ }

-- (*@$s\mapsto \left(x\mapsto \nicefrac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}\right)$ where $n, d\in\mathcal{A}_i$, this is $\nicefrac{\nicefrac{nd^{m-1}}{f^i}}{\nicefrac{d^m}{f^i}}$, see \Cref{thm:def-alpha}.@*)
def fmk (y : unop U) : (*@$(\mathtt A^0_ \mathtt f)_{\mathtt y}$@*) :=
mk (num hm f_deg s y) ⟨denom hm f_deg s y, _⟩

def to_fun : 
  ((Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f))).obj U ⟶ 
  (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf.obj U :=
{ to_fun := λ s, ⟨λ y, fmk hm f_deg s y, sorry /-proof of being locally a fraction-/⟩, ..sorry /-proof of being a ring homomorphism-/},
end to_Spec
\end{lstlisting}
After checking being a ring homomorphism and locally a fraction, one obtains a morphism between sheaves.
\begin{lstlisting}
def to_Spec :
  (Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f)).presheaf ⟶
  (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf :=
{ app := λ U, to_Spec.to_fun hm f_deg U,
  naturality' := λ U V subset1, by { ext1, simpa } }
end Proj_iso_Spec_Sheaf_component
\end{lstlisting}
Hence it has been shown that $(D(f), \mathcal{O}_{\operatorname{Proj}\mathcal A})\cong (\operatorname{Spec}A^0_f, \mathcal{O}_{\operatorname{Spec}A^0_f})$ as locally ringed spaces and hence $(\operatorname{Proj}\mathcal A, \mathcal{O}_{\operatorname{Proj}\mathcal A})$ is a scheme.
\begin{lstlisting}
def Sheaf_component:
  (Proj_iso_Spec_Top_component hm f_deg).hom _* (Proj| D(f)).presheaf ≅
  (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf :=
{ hom := Proj_iso_Spec_Sheaf_component.to_Spec 𝒜 hm f_deg,
  inv := Proj_iso_Spec_Sheaf_component.from_Spec 𝒜 hm f_deg,
  ..sorry /-composition is identity-/ }

def iso: (Proj| D(f)) ≅ Spec (*@$\mathtt A^0_ \mathtt f$@*) :=
let H : (Proj| D(f)).to_PresheafedSpace ≅ (Spec (*@$\mathtt A^0_ \mathtt f$@*)).to_PresheafedSpace :=
  PresheafedSpace.iso_of_components
    (Proj_iso_Spec_Top_component hm f_deg) (Sheaf_component 𝒜 f_deg hm) in
LocallyRingedSpace.iso_of_SheafedSpace_iso
{ hom := H.1, inv := H.2, hom_inv_id' := H.3, inv_hom_id' := H.4 }

def Proj.to_Scheme : Scheme :=
{ local_affine := sorry,..Proj }
\end{lstlisting}

% $\beta_U$ preserves multiplication, let $s_1, s_2$ be two sections and $y\in\phi^{-1}(U)$, by writing 
% $s_1(\phi(y))$ as $\frac{\nicefrac{a_1}{f^{i_1}}}{\nicefrac{b_1}{f^{j_1}}}$, $s_2(\phi(y))$ as $\frac{\nicefrac{a_2}{f^{i_2}}}{\nicefrac{b_2}{f^{i_2}}}$ and $(s_1s_2)(\phi(y))=\frac{\nicefrac{a_{12}}{f^{i_{12}}}}{\nicefrac{b_{12}}{f^{j_{12}}}}$, one deduces that $\frac{\nicefrac{a_1a_2}{f^{i_1+i_2}}}{\nicefrac{b_1b_2}{f^{j_1+j_2}}}=\frac{\nicefrac{a_{12}}{f^{i_{12}}}}{\nicefrac{b_{12}}{f^{j_{12}}}}$, by definition of localisation, it implies that, there is some $\frac{c}{f^l}$ such that $$\frac{a_1a_2b_{12}c}{f^{i_1+i_2+j_{12}+l}}=\frac{a_{12}b_1b_2c}{f^{i_{12}+j_1+j_2+l}}.$$ Hence, there is some $L\in\mathbb N$, such that 
%         $$a_1a_2b_{12}cf^{i_{12}+j_1+j_2+l+L}=a_{12}b_1b_2cf^{i_1+i_2+j_{12}+l+L},$$ implying that
%         $$
%         \frac{a_{12}f^{j_{12}}}{b_{12}f^{i_{12}}}=\frac{a_1f^{j_1}}{b_1f^{i_1}}\cdot\frac{a_2f^{j_2}}{b_2f^{i_2}}.$$

\subsection{Reflection}

\paragraph*{An example of calculation}
Most calculations in proofs of \Cref{thm:homeomorph,thm:def-alpha,thm:def-beta} are omitted.
I present the details of verifying $\beta_U$ preserves multiplication to showcase the flavour of calculations involved. Other calculations are more or less similar.

Let $x, y$ be two sections, the aim is to show $\beta_U(xy)=\beta_U(x)\beta_U(y)$, i.e. for all $z\in\phi^{-1}(U)$, $\beta_U(xy)(z)=\beta_U(x)(z)\beta_U(y)(z)$.
\begin{lstlisting}
lemma bmk_mul (x y : (Spec (*@$\mathtt A^0_ \mathtt f$@*)).presheaf.obj V) :
  bmk hm f_deg V (x * y) = bmk hm f_deg V x * bmk hm f_deg V y :=
begin
  ext1 z,
\end{lstlisting}
by writing $x(\phi(z))$ as $\frac{\nicefrac{a_x}{f^{i_x}}}{\nicefrac{b_x}{f^{j_x}}}$, $y(\phi(z))$ as $\frac{\nicefrac{a_y}{f^{i_y}}}{\nicefrac{b_y}{f^{j_y}}}$ and $(xy)(\phi(z))=\frac{\nicefrac{a_{xy}}{f^{i_{xy}}}}{\nicefrac{b_{xy}}{f^{j_{xy}}}}$, one deduces that $\frac{\nicefrac{a_xa_y}{f^{i_x+i_y}}}{\nicefrac{b_xb_y}{f^{j_x+j_y}}}=\frac{\nicefrac{a_{xy}}{f^{i_{xy}}}}{\nicefrac{b_{xy}}{f^{j_{xy}}}}$, by definition of equality in localised ring, it implies that, there is some $\frac{c}{f^l}$ such that $$\frac{a_xa_yb_{xy}c}{f^{i_x+i_y+j_{xy}+l}}=\frac{a_{xy}b_xb_yc}{f^{i_{xy}+j_x+j_y+l}}.$$
\begin{lstlisting}
  have mul_eq := data.eq_num_div_denom hm f_deg (x * y) z,
  ..,
  erw is_localization.eq at mul_eq,
  obtain ⟨⟨C, hC⟩, mul_eq⟩ := mul_eq, -- C is the (*@$\nicefrac c{f^l}$@*) above.
  ...
  -- setting up notations.
  set a_xy := _, set i_xy := _, set b_xy := _, set j_xy := _,
  set a_x := _, set i_x := _, set b_x := _, set j_x := _,
  set a_y := _, set i_y := _, set b_y := _, set j_y := _,
  set l := _,
\end{lstlisting}
By definition of equality in localisation again, there exists some $n_1\in \mathbb{N}$ such that
\begin{equation}\label{eqn:example-intermediate}
  a_xa_yb_{xy} c f^{i_xy+j_x+j_y+l+n_1} = a_{xy}b_xb_y c f^{i_x+i_y+j_{xy}+l+n_1}  
\end{equation}

\begin{lstlisting}
  ... -- more simplification
  obtain ⟨⟨_, ⟨n1, rfl⟩⟩, mul_eq⟩ := mul_eq,
  ...
\end{lstlisting}
By \Cref{eqn:example-intermediate} and definition of equality in localised ring, $c f^{l+n_1}$ verifies this equality $$\frac{a_{xy}f^{j_{xy}}}{b^{xy}f^{i_x}}=\frac{a_x f^{j_x}}{b^x f^{i_x}} \frac{a_y f^{j_y}}{b_y f^{i_y}},$$.
\begin{lstlisting}
  suffices : (mk (a_xy * f ^ j_xy) ⟨b_xy * f ^ i_xy, _⟩ : localization.at_prime _) 
  = mk (a_x * f ^ j_x) ⟨b_x * f ^ i_x, _⟩ * mk (a_y * f ^ j_y) ⟨b_y * f ^ i_y, _⟩ := sorry,
    ...
  refine ⟨⟨C.num * f^(l + n1), _⟩, _⟩,
    ...
end
\end{lstlisting}
In totality, this is about \textasciitilde100 lines of (not the most optimal) code by following essentially three lines of calculation when done with pen-and-papers. I think the following factors contribute to the differences between formalisation and a pen-and-paper-proof:
\begin{itemize}
    \item Every element of a localised ring can be written as a fraction of a numerator and a denominator is a corollary of the construction but not straightly from its definition. Thus, many extra steps are required to set up the proof.
    \item Elements of a (homogeneously) localised ring contains not only data, but proofs as well. For example, the denominator of an element is a term \lstinline{⟨d, some_proof⟩} of a subtype. This makes \lstinline{rewrite} less smooth to use, for equalities are often of the form \lstinline{h : d = d'}, thus \lstinline{rewrite [h]} is type theoretically unsound.
    \item Terms of \lstinline{localization x} or \lstinline{homogeneous_localization 𝒜 x} have to contain proofs to make the definitions correct, thus constructing any term of these types requires many proofs or disproofs of membership. Thus, a formalised calculation cannot be as liberal as a pen-and-paper-proof when comes whether the terms are well-defined.
    \item Not many high powered tactics are available for localised ring, for example \lstinline{ring} will be able to solve \lstinline{x * y = y * x} and much more complicated goal in a commutative ring, but \lstinline{ring} cannot (and should not be able to) solve \lstinline{(a / b * c / d : localization _) = c / b * a / d}.
\end{itemize}
The first three bullet points are essentially because formalisations require more rigour than that of pen-and-paper-proofs; whether the requirement of extra rigour is beneficial is not in the scope of this paper. For the fourth bullet point, it is definitely helpful to have a tactic automating many proofs, the catch is that equality in localised ring is existentially quantified --- $\frac a b = \frac {a'}{b'}$ if and only if $ab' c = a' b c$ for some $c$ in a multiplicative subset. Thus, a tactic can only do so much without human input for now.

\paragraph*{On propositional equality}
Originally, I expected propositional equalities that are not equal by definition such as $\phi(\psi(y)) = y$ in \Cref{thm:homeomorph} will pose a challenge, but the difficulty is less severe and can be solved by providing some mathematically irrelevant lemma --- indeed, I only need to prove some redundant lemma for $\phi(\psi(y))$ when it is true for $y$; the reason is that this project did not involve comparing algebraic structures depending on propositional equalities, for example $\mathcal{O}_{X, x}$ and $\mathcal{O}_{Y, \phi(x)}$ are isomorphic when $X, Y$ are isomorphic as schemes; but foreseeably, this difficulty will come back when one starts to develop the theory of projective variety furtherer. The solution to this problem is to build more APIs especially congruence lemmas.

\section{Conclusion} 

Since a large part of modern algebraic geometry depends on $\operatorname{Proj}$ construction, much potential future research is possible: calculating cohomology of projective spaces; defining projective morphisms; Serre's twisting sheaves. Other approaches to $\operatorname{Proj}$ construction also exists, for example, by gluing a family of schemes together; however, since there is no other formalisation of $\operatorname{Proj}$ construction, I could neither compare merits of different approaches nor compare capabilities of formalising modern algebraic geometry across different theorem provers. Thus I would like to conclude this paper with an invitation/challenge --- state and formalise something involving more than affine schemes in your preferred theorem prover; for the only way to know which, if any, theorem provers handles modern mathematics satisfactorily is to actually formalise more modern mathematics.

\bibliography{ref}

\end{document}

